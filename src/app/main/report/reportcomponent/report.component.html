<div id="report" class="page-layout simple fullwidth" fxLayout="column">

   <!-- HEADER -->
   <div class="header accent p-20 h-120" fxLayout="row" fxLayoutAlign="start center">
        <div fxLayout="column" fxLayoutAlign="center start">
            <div fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="secondary-text s-18">receipt</mat-icon>
                <mat-icon class="secondary-text s-16">chevron_right</mat-icon>
                <span class="secondary-text">Report</span>
                <!-- <div class="secondary-text h2">Report</div> -->
            </div>
            <div class="h1 mt-16">{{ currentCategoryName }}</div>
        </div>
    </div>
    <!-- / HEADER -->


    <div class="content p-24">  

        <div class="vertical-stepper-wrapper">
            <mat-vertical-stepper class="mat-elevation-z4" [linear]="true" #stepper [selectedIndex]="selectedIndex" (selectionChange)="selectionChange($event)">
                <mat-step [stepControl]="reportStep">

                    <form fxLayout="column" [formGroup]="reportStep">

                        <ng-template matStepLabel>Select Report</ng-template>

                        <div fxFlex="1 0 auto" fxLayout="column" class="m-16 mt-0"  style="border: 1px solid #3b3b3b; border-radius: 5px;">

                            <div  fxLayout="row" fxLayoutAlign="center" >
                                <div class="filter_company_input">
                                    <input matInput  formControlName="filterstring" #filter placeholder="Search" (keyup) = "onKeyFilter($event, 'report')">
                                    <mat-icon (click)="clearFilter()">clear</mat-icon>
                                </div>
                            </div>

                            <div class="report_table ml-12" style="width: 80%; overflow: auto;">
                                <mat-table [dataSource]="dataSourceReport" fusePerfectScrollbar>
                                    <ng-container matColumnDef="id">
                                        <mat-cell *matCellDef="let report" style="flex-basis: 10%; flex-grow: 0; flex-shrink: 1">
                                            <mat-checkbox (click)="$event.stopPropagation()"
                                                (change)="$event ? reportSelection.toggle(report.id) : null"
                                                [checked]="reportSelection.isSelected(report.id)"
                                                formControlName="report" required
                                                >
                                            </mat-checkbox>
                                        </mat-cell>
                                    </ng-container>

                                    <ng-container matColumnDef="name">
                                        <mat-cell *matCellDef="let report" class="p-0">
                                            <p class="report text-truncate">{{report.name}}</p>
                                        </mat-cell>
                                    </ng-container>
                                    <mat-row  *matRowDef="let report; columns: reportColumns;" matRipple style="border-bottom-width: 0px;">
                                    </mat-row>

                                </mat-table>
                            </div>

                            <mat-paginator 
                                #paginatorReport
                                showFirstLastButtons
                                class="table_paginator_detail"
                                [length]="dataSourceReport.totalLength"
                                [pageSize]="5"
                                [hidePageSize]="true"
                            ></mat-paginator>
                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button mat-raised-button matStepperNext type="button" color="accent" (click)="getReportParams()">
                                Next
                            </button>
                        </div>

                    </form>

                </mat-step>
                
                <mat-step *ngIf="loadingSubjectCompany | async" >

                    <form fxLayout="column" [formGroup]="companyStep">

                        <ng-template matStepLabel>Company</ng-template>

                        <div fxFlex="1 0 auto" fxLayout="column" class="m-16 mt-0"  style="border: 1px solid #3b3b3b; border-radius: 5px;" >

                            <div  fxLayout="row" fxLayoutAlign="center" >
                                <div class="filter_company_input">
                                    <input matInput  formControlName="filterstring" #filter placeholder="Search" (keyup) = "onKeyFilter($event, 'company')">
                                    <mat-icon (click)="clearFilter()">clear</mat-icon>
                                </div>
                            </div>

                            <div class="report_table ml-12" style="width: 80%; overflow: auto;">
                                <mat-table [dataSource]="dataSourceCompany" fusePerfectScrollbar>
                                    <ng-container matColumnDef="id">
                                        <mat-cell *matCellDef="let company" style="flex-basis: 10%; flex-grow: 0; flex-shrink: 1">
                                            <mat-checkbox (click)="$event.stopPropagation()"
                                                (change)="$event ? companySelection.toggle(company) : null"
                                                [checked]="companySelection.isSelected(company)"
                                                required
                                                >
                                            </mat-checkbox>
                                        </mat-cell>
                                    </ng-container>

                                    <ng-container matColumnDef="name">
                                        <mat-cell *matCellDef="let company" class="p-0">
                                            <p class="report text-truncate">{{company.name}}</p>
                                        </mat-cell>
                                    </ng-container>
                                    <mat-row  *matRowDef="let company; columns: reportColumns;" matRipple style="border-bottom-width: 0px;">
                                    </mat-row>

                                </mat-table>
                            </div>

                            <mat-paginator 
                                #paginatorCompany
                                showFirstLastButtons
                                class="table_paginator_detail"
                                [length]="dataSourceCompany.totalLength"
                                [pageSize]="5"
                                [hidePageSize]="true"
                                (click)="paginatorClick(paginatorCompany)"
                            ></mat-paginator>

                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button class="mr-8" mat-raised-button matStepperPrevious type="button" color="accent">
                                Previous
                            </button>
                            <button mat-raised-button matStepperNext type="button" color="accent">
                                Next
                            </button>
                        </div>

                    </form>

                </mat-step>

                <mat-step *ngIf="loadingSubjectGroup  | async">

                    <form fxLayout="column" [formGroup]="groupStep">

                        <ng-template matStepLabel>Group</ng-template>

                        <div fxFlex="1 0 auto" fxLayout="column" class="m-16 mt-0"  style="border: 1px solid #3b3b3b; border-radius: 5px;">

                            <div  fxLayout="row" fxLayoutAlign="center" >
                                <div class="filter_company_input">
                                    <input matInput  formControlName="filterstring" #filter placeholder="Search" (keyup) = "onKeyFilter($event, 'group')">
                                    <mat-icon (click)="clearFilter()">clear</mat-icon>
                                </div>
                            </div>

                            <div class="report_table ml-12" style="width: 80%; overflow: auto;">
                                <mat-table [dataSource]="dataSourceGroup" fusePerfectScrollbar>
                                    <ng-container matColumnDef="id">
                                        <mat-cell *matCellDef="let group" style="flex-basis: 10%; flex-grow: 0; flex-shrink: 1">
                                            <mat-checkbox (click)="$event.stopPropagation()"
                                                (change)="$event ? groupSelection.toggle(group) : null"
                                                [checked]="groupSelection.isSelected(group)"
                                                required
                                                >
                                            </mat-checkbox>
                                        </mat-cell>
                                    </ng-container>

                                    <ng-container matColumnDef="name">
                                        <mat-cell *matCellDef="let group" class="p-0">
                                            <p class="report text-truncate">{{group.name}}</p>
                                        </mat-cell>
                                    </ng-container>
                                    <mat-row  *matRowDef="let group; columns: reportColumns;" matRipple style="border-bottom-width: 0px;">
                                    </mat-row>

                                </mat-table>
                            </div>

                            <mat-paginator 
                                #paginatorGroup
                                showFirstLastButtons
                                class="table_paginator_detail"
                                [length]="dataSourceGroup.totalLength"
                                [pageSize]="5"
                                [hidePageSize]="true"
                                (click)="paginatorClick(paginatorGroup)"
                            ></mat-paginator>

                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button class="mr-8" mat-raised-button matStepperPrevious type="button" color="accent">
                                Previous
                            </button>
                            <button mat-raised-button matStepperNext type="button" color="accent">
                                Next
                            </button>
                        </div>

                    </form>

                </mat-step>

                <mat-step [stepControl]="outputStep" >

                    <form fxLayout="column" [formGroup]="outputStep">

                        <ng-template matStepLabel>OutPut Format</ng-template>

                        <div fxFlex="1 0 auto" fxLayout="row">

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Address</mat-label>
                                <textarea matInput formControlName="address" required>
                                    1600 Amphitheatre Pkwy
                                </textarea>
                                <mat-error>Address is required!</mat-error>
                            </mat-form-field>

                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button class="mr-8" mat-raised-button matStepperPrevious type="button" color="accent">
                                Previous
                            </button>
                            <button mat-raised-button (click)="finishVerticalStepper()" type="button" color="accent">
                                Finish
                            </button>
                        </div>

                    </form>

                </mat-step>
            </mat-vertical-stepper>

        </div>
    </div>
</div>
