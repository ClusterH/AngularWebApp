<div id="dashboard-analytics" class="page-layout carded fullwidth tabbed">
    <!-- TOP BACKGROUND -->
    <div class="top-bg accent"></div>
    <!-- / TOP BACKGROUND -->
    <!-- CENTER -->
    <div class="center">
        <!-- CONTENT HEADER -->
        <div class="header accent p-24">
            <div class="title-clips h-52" fxLayout="row" fxLayoutAlign="start center">
                <div class="h1" fxFlex="30">Dashboards</div>
                <div class="clip-list" *ngIf="isEditClips">
                    <div *ngFor="let clip of dashboardclips_Clist" class="draggable" draggable="true"
                        (dragend)="addNewWidget(clip)" (click)="addNewWidget(clip)">
                        <img [src]="clip_img_url + clip.name + '.png'"
                            class="w-40 mat-elevation-z8 chart-icon line-chart">
                    </div>
                </div>
            </div>
            <div class="filter-save-edit-button" fxLayout="row" fxLayoutAlign="space-between center">
                <div class="filter-option" fxLayout="row" fxFlex="85">
                    <div class="time-filter-option" fxLayout="row" fxFlex="50">
                        <form class="time-filter-form" fxLayout="row" fxLayoutAlign="start center">
                            <!-- FILTER ITEM -->
                            <mat-label style="min-width: max-content;">Time:&nbsp;&nbsp;</mat-label>
                            <mat-form-field class="ml-20 mr-20 filter_select" style="min-width: 140px;">
                                <mat-select [(value)]="selectedTime">
                                    <mat-option>None</mat-option>
                                    <mat-option value="today">Today</mat-option>
                                    <mat-option value="this_week">This Week</mat-option>
                                    <mat-option value="this_month">This Month</mat-option>
                                    <mat-option value="date_range">Date Range</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </form>
                        <div *ngIf="selectedTime == 'date_range'">
                            <div class="date-range">
                                <form [formGroup]="dateRangeForm">
                                    <mat-form-field style="min-width: 220px;">
                                        <input matInput class="pl-12" (dateChange)="rangeChange($event)"
                                            [satDatepicker]="picker2" formControlName="date">
                                        <sat-datepicker #picker2 [rangeMode]="true">
                                        </sat-datepicker>
                                        <sat-datepicker-toggle matSuffix [for]="picker2" style="color: whitesmoke">
                                        </sat-datepicker-toggle>
                                    </mat-form-field>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="group-filter-option" fxLayout="row" fxFlex="50">
                        <form class="group-filter-form" fxLayout="row" fxLayoutAlign="start center">
                            <!-- FILTER ITEM -->
                            <mat-label style="min-width: max-content;">Group:</mat-label>
                            <mat-form-field class="ml-20 mr-20 filter_select" style="min-width: 140px;">
                                <mat-select [(value)]="selectedGroup">
                                    <mat-option>None</mat-option>
                                    <mat-option value="vehicle">Vehicle</mat-option>
                                    <mat-option value="company">Company</mat-option>
                                    <mat-option value="group">Group</mat-option>
                                    <mat-option value="vehicletype">Vehicle Type</mat-option>
                                    <mat-option value="serviceplan">Service Plan</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </form>
                    </div>
                </div>
                <div class="add-edit-button" *ngIf="!isEditClips" fxFlex="15">
                    <button mat-raised-button class="add-new-widget mr-4" (click)="addDashboard()">
                        <span>&nbsp;&nbsp;ADD&nbsp;&nbsp;</span>
                    </button>
                    <button mat-raised-button class="add-new-widget mr-4" (click)="editDashboard()">
                        <span>&nbsp;&nbsp;EDIT&nbsp;&nbsp;</span>
                    </button>
                </div>
                <div class="save-cancel-button" *ngIf="isEditClips" fxFlex="15">
                    <button mat-raised-button class="save-dashboard-button mr-4" (click)="saveDashboardClips()">
                        <span>&nbsp;&nbsp;SAVE&nbsp;&nbsp;</span>
                    </button>
                    <button mat-raised-button class="save-dashboard-button" (click)="cancelDashboardClips()">
                        <span>CANCEL</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- / CONTENT HEADER -->
        <!-- CONTENT CARD -->
        <div class="content-card">
            <!-- CONTENT -->
            <div class="content">
                <!-- <div class="spinner_overlay" *ngIf="loading$ | async">
                    <div class="spinner_container">
                        <mat-spinner color="accent" mode="indeterminate" diameter="50" style="margin:0 auto;">
                        </mat-spinner>
                    </div>
                </div> -->
                <mat-tab-group #tabs *ngIf="loading$ | async" (selectedTabChange)="tabChanged($event)"
                    [(selectedIndex)]="activatedTabIndex">
                    <mat-tab *ngFor="let dashboard of dashboard_Clist; let i = index" [label]="dashboard.name"
                        [disabled]="isEditClips">
                        <ng-template mat-tab-label>
                            <mat-icon class="active-icon s-16 delete_icon" (click)="deleteDashboard(dashboard)"
                                [ngStyle]="{'display':(!isEditClips || !(activatedTabIndex == i))? 'none': 'block' }">
                                delete
                            </mat-icon>
                            <input type="text" class="tab_label_input" [(ngModel)]="dashboard.name"
                                [disabled]="!isEditClips || !(activatedTabIndex == i)">
                        </ng-template>
                        <div class="tab-content p-0">
                            <app-layout [isEditClips]="isEditClips" [widgets]="currentTab_widgets"
                                (editedDashboard)='checkingEdited($event)'>
                            </app-layout>
                        </div>
                    </mat-tab>
                </mat-tab-group>
            </div>
            <!-- / CONTENT -->
        </div>
        <!-- / CONTENT CARD -->
    </div>
    <!-- / CENTER -->
</div>